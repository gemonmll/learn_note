## **多轮对话能力实现**
> 项目目标
> ![Alt text](image.png)
> 架构设计
> ![Alt text](image-1.png)
> ![Alt text](image-2.png)
> 能力要求
> 多agent协同（langGraph），mcp工具太多会产生问题，需要对agent进行分工
> ![Alt text](image-3.png)
> mcp部分
> ![Alt text](image-4.png)
> **1 多轮对话能力原理介绍**
> 构建session级别的多轮对话能力
> 架构如下
> 核心原理在于chatpromptTemplate
> ![Alt text](image-5.png)
> ![Alt text](image-6.png)
> 构建提示词模板，用于注入对话历史
> ![Alt text](image-7.png)
> 这次的会话需要与session绑定
> ![Alt text](image-8.png)
> **2 多轮对话LELC实现**
> 1 大模型
> ![Alt text](image-9.png)
> 2 prompt提示词 history
> ![Alt text](image-10.png)
> 3 创建chain
> ![Alt text](image-11.png)
> 4 构建基于历史消息的Runnable实例
> ![Alt text](image-12.png)
> 5 构建多轮对话
> ![Alt text](image-13.png)
> 6 运行多轮对话
> ![Alt text](image-14.png)
> **3 session持久化**
> 步骤如下
> ![Alt text](image-15.png)
> 第一步：定义文件系统根路径
> 第二步：根据session_id获取文件名
> 第三步：根据session_id存储和读取对话json文件内容
> 第四步：改造get_session_history方法
> 第五步：改造运行会话方法
> ![Alt text](image-16.png)
> ![Alt text](image-17.png)
> ![Alt text](image-18.png)
> 优化持久化
> ![Alt text](image-19.png)